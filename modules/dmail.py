from eth_abi import encode
from web3 import Web3
import random

from modules import standart

def rando():
    n = 0
    str_ = ''
    alfavit = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z','1','2','3','4','5','6','7','8','9','0']
    while True:
        r = random.choice(alfavit)
        str_ = str_ + r
        n = n +1
        if n == 7:
            break
    return str_

def dmaill(wal:standart.Wal,w3:Web3):
    r = rando()
    to = f"{r}@dmail.ai"
    subject = f"{wal.adress}@dmail.ai"
    contract  =w3.eth.contract(address='0x981F198286E40F9979274E0876636E9144B8FB8E', abi='[ { "name": null, "type": "constructor", "inputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "name": "adminchanged", "anonymous": false, "inputs": [ { "name": "previousadmin", "type": "address", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "newadmin", "type": "address", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "approval", "anonymous": false, "inputs": [ { "name": "owner", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "spender", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "value", "type": "uint256", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "beaconupgraded", "anonymous": false, "inputs": [ { "name": "beacon", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "initialized", "anonymous": false, "inputs": [ { "name": "version", "type": "uint8", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint8", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "message", "anonymous": false, "inputs": [ { "name": "subject", "type": "string", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true }, { "name": "from_address", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "to", "type": "string", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "ownershiptransferred", "anonymous": false, "inputs": [ { "name": "previousowner", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "newowner", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "paused", "anonymous": false, "inputs": [ { "name": "account", "type": "address", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "transfer", "anonymous": false, "inputs": [ { "name": "from", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "to", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "value", "type": "uint256", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "unpaused", "anonymous": false, "inputs": [ { "name": "account", "type": "address", "indexed": false, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "name": "upgraded", "anonymous": false, "inputs": [ { "name": "implementation", "type": "address", "indexed": true, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "type": "event", "_isfragment": true }, { "type": "function", "name": "allowance", "constant": true, "inputs": [ { "name": "owner", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "spender", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "approve", "constant": false, "inputs": [ { "name": "spender", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "balanceof", "constant": true, "inputs": [ { "name": "account", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "burn", "constant": false, "inputs": [ { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "burnfrom", "constant": false, "inputs": [ { "name": "account", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "decimals", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "uint8", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint8", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "decreaseallowance", "constant": false, "inputs": [ { "name": "spender", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "subtractedvalue", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "increaseallowance", "constant": false, "inputs": [ { "name": "spender", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "addedvalue", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "initialize", "constant": false, "inputs": [], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "mint", "constant": false, "inputs": [ { "name": "to", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "name", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "string", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "owner", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "pause", "constant": false, "inputs": [], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "paused", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "proxiableuuid", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "bytes32", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bytes32", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "renounceownership", "constant": false, "inputs": [], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "send_mail", "constant": false, "inputs": [ { "name": "to", "type": "string", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true }, { "name": "subject", "type": "string", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "symbol", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "string", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "string", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "totalsupply", "constant": true, "inputs": [], "outputs": [ { "name": null, "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "payable": false, "statemutability": "view", "gas": null, "_isfragment": true }, { "type": "function", "name": "transfer", "constant": false, "inputs": [ { "name": "to", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "transferfrom", "constant": false, "inputs": [ { "name": "from", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "to", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "amount", "type": "uint256", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "uint256", "_isparamtype": true } ], "outputs": [ { "name": null, "type": "bool", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bool", "_isparamtype": true } ], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "transferownership", "constant": false, "inputs": [ { "name": "newowner", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "unpause", "constant": false, "inputs": [], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "upgradeto", "constant": false, "inputs": [ { "name": "newimplementation", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true } ], "outputs": [], "payable": false, "statemutability": "nonpayable", "gas": null, "_isfragment": true }, { "type": "function", "name": "upgradetoandcall", "constant": false, "inputs": [ { "name": "newimplementation", "type": "address", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "address", "_isparamtype": true }, { "name": "data", "type": "bytes", "indexed": null, "components": null, "arraylength": null, "arraychildren": null, "basetype": "bytes", "_isparamtype": true } ], "outputs": [], "payable": true, "statemutability": "payable", "gas": null, "_isfragment": true } ]')
    data = contract.encodeABI("send_mail", args=(to, subject))
    tx = {
        "chainId": 324,
        "nonce": w3.eth.get_transaction_count(wal.adress),
        "from": Web3.to_checksum_address(wal.adress),
        "to": Web3.to_checksum_address('0x981F198286E40F9979274E0876636E9144B8FB8E')
    }
    tx["data"] = data
    tx["value"] = 0
    tx["gasPrice"] = w3.eth.gas_price
    tx["gas"] = w3.eth.estimate_gas(tx)
    
    res = standart.sing_tx(w3,tx,wal,modul='dmail')